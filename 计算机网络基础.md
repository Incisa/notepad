# 计算机网络基础详细复习（一）


> 起源于一次面试，发现自己关于计算机网络基础内容记忆和理解不够深刻。在此总结一下，依照《图解http》这本书内容为主，强化记忆和理解

### 网络基础、TCP/IP 协议族

* 每台接入互联网的电脑都有一个 IP 地址
  - ipv4：互联网协议版本 4（Internet Protocol version 4，IPv4），又称互联网通信协议第四版，是互联网协议开发过程中的第四个修订版本，也是此协议第一个被广泛部署的版本
  - 即使 ipv4 拥有 43 亿个地址，但是也出现了不够用情况
  - 网络地址转换（Network Address Translation，缩写为 NAT）出现了
  - 局域网 pc 通过 NAT 协议来连接互联网

  访问一个网站，其实就是在与互联网上的另一台计算机通信。而通信肯定需要知道那台电脑的具体 IP 地址，就像打电话需要知道那个人的电话号码一样。然而，我们访问的时候，并没有告诉浏览器 Google 的服务器的 IP 地址。

  那浏览器是如何知道的呢？很明显，这个 IP 地址信息隐藏在了上面的网址里面。

  **域名(Domain Name)**，就像手机里的电话本，IP 地址，就像某条通信录的电话，那么上面网上的哪一部分隐藏了服务器的 IP 地址呢？？？很明显，是 www.google.com 这一部分，这个部分叫做 “域名”


* 计算机（浏览器）如何得到这个域名所代表的 ip 地址呢？以及，为什么要有域名呢？
  - ip 地址很明显比较难记，而且也没有太明显的具体意义
  - 所以给 ip 地址起个名字就显得有必要了
  - 而这个名字就是域名了

  所以，一个域名就代表了一个 ip，而后代表了一台接入互联网的计算机

* 几个特殊的 IP 地址
  - 127.0.0.1 总是代表当前计算机

  两台计算机之间通信，理所当然需要使用一个双方都明白的 “规则”，就像你去邮局写信，需要按照指定的格式把必要的信息写在信封一样。因为很显然，通过电线，只能传输电信号，每一个电信号代表什么意思就成了至关重要的事情了。而电线可以传输高电位与低电位，就可以用这两种状态分别代表 0 和 1，就是二进制。于是，世界形成了。

  而我们把这种通信规则成为：**协议（protocol）**

  我们通常使用的网络（包括互联网）则是在 **TCP/IP 协议族** 的基础上运作的，而 HTTP 则是它内部的一个子集

  > TCP/IP 是互联网相关的各类协议族的总称，里面包括：IEEE 802.3、FDDI、ICMP、TCP、IP、HTTP、FTP、DNS、PPPoE、SNMP、UDP 等。一般来说，一个协议往往是基于其它协议的。

### TCP/IP 的分层管理

* TCP/IP 协议族里最重要的一点就是分层。TCP/IP 协议族按照层次分别分为以下 4 层：
  - 应用层
  - 传输层
  - 网络层
  - 数据链路层

  **TCP/IP 层次化的优点：**
  互联网只有一个协议统筹的话，当某个地方需要重新设计，则必须把所有部分整体替换掉。而分层之后只需把需要变动的层替换掉即可。并且设计也变得简单，每个层次只需要解决自己层面的问题而不用考虑整体。

  **应用层：**
  应用层决定了向用户提供应用服务时通信的活动。TCP/IP 协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和 DNS（Domain Name System，域名系统）服务就是其中两类。HTTP 协议也处于该层。

  **传输层：**
  传输层对上层应用层，提供处于网络；连接中两台计算机之间的数据传输。在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报协议）

  **网络层（又名网络互连层）：**
  网络层用来处理网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或者网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线。

  **链路层（又名数据链路层、网络接口层）：**
  用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器、即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。

### TCP/IP 通信传输流
 
![](https://github.com/Incisa/notepad/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip01.jpg?raw=true)

利用 TCP/IP 协议族进行网络通信时，会通过分层顺序与对方进行通信，发送端从应用层往下走，接收端则从应用层往上走。

![](https://github.com/Incisa/notepad/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip02.jpg?raw=true)

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，没进过一层时会把对应的首部消去。

这种把信息包装起来的做法叫做**封装（encapsulate）**


### 与 HTTP 关系密切的协议：IP、TCP 和 DNS

**负责传输的 IP 协议**

* IP（Internet Protocol）网络协议位于位于网络层。Internet Protocol 这个名称可能听起来有点夸张，但事实正是如此，因为几乎所有使用网络的系统都会用到 IP 协议。TCP/IP 协议族中的 IP 指的就是网际协议，协议名称中占据了一半位置，其重要性可见一斑。可能有人会把“IP”和“IP 地址”搞混，“IP”其实是一种协议的名称。

* IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC地址（Media Access Control Address）。

* IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改。

**确保可靠性的 TCP 协议**

* 互联网最重要的协议是 TCP 协议（Transmition Control Protocol传输控制协议）（很遗憾不是 HTTP，不过 HTTP 是使用最广泛的协议）

* 按层次分，TCP 位于传输层，提供可靠的字节流服务。

> 字节流服务（Byte Stresam Sevice）:为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。

* 而可靠的传输服务是指，能够把数据准确可靠的传送给对方。**TCP 协议是为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方**

* TCP 协议把两台计算机的通信抽象成了一组很简单的接口（函数）
  * send(ip, content)
  * content = read()

  两台计算机之间建立起了 TCP 连接后就像有一个管道连接在两台计算机之间。而为了准确无误的将数据送达目标处，TCP协议采用了**三次握手（three-way handshaking）**策略。而数据保证发送成功肯定是需要一个反馈。这种反馈叫做 ACK（即确认字符，在数据通信中，接收站发给发送站的一种传输类控制字符。表示发来的数据已确认接收无误）。事实上并不是两台计算机在通信，而是两台计算机上的程序在通信。

  ![](https://github.com/Incisa/notepad/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/three-way-handshaking.jpg?raw=true)

  发送端首先发送一个带有 SYN 标志的数据包给对方。接收端收到后，回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。

  若在握手过程中某个阶段莫名中断，TCP协议会再次以相同的顺序发送相同的数据包。 

**负责域名解析的的 DNS 服务**

  计算机通过 DNS 服务（Domain Name Service）来得到一个域名所对应的 ip 地址。它和 HTTP 协议一样是位于应用层的协议，它提供域名到 IP 地址之间的解析服务。DNS 服务器需要预先配置在电脑里， DNS 服务器的地址我们需要以 ip 地址的形式告诉计算机。

  ![](https://github.com/Incisa/notepad/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/dns01.jpg?raw=true)

各种协议在各自的层面上分别发挥各自的功能。

![](https://github.com/Incisa/notepad/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/tcpip03.jpg?raw=true)